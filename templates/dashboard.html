{% extends 'base.html' %}

{% block title %}Dashboard - Premier Medical And Technical Institute{% endblock %}

{% block content %}
<!-- Welcome Banner - Edge-to-Edge -->
<section class="welcome-banner"
    style="padding: 4rem 0; color: white; {% if site_config and site_config.dashboard_background %}background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url('{{ site_config.dashboard_background.url }}'); background-size: cover; background-position: center; background-attachment: fixed;{% else %}background: linear-gradient(135deg, #1e3a8a, #3b82f6);{% endif %} margin-top: -3rem; width: 100%;">
    <div class="container">
        <h1 style="color: white; font-weight: 900; font-size: 3rem; margin-bottom: 0.75rem; line-height: 1.2;">
            Welcome back, {{ student.user.first_name }}!
        </h1>
        <p style="color: rgba(255, 255, 255, 0.95); font-size: 1.25rem; font-weight: 500;">
            Registration No: <span style="font-weight: 700;">{{ student.student_id }}</span> | Batch: <span
                style="font-weight: 700;">{{ student.batch }}</span>
        </p>
    </div>
</section>

<div class="container" style="margin-top: 3rem;">
    <!-- Quick Stats -->
    <div class="grid grid-4" style="margin-bottom: 3rem;">
        <div class="card" style="background: linear-gradient(135deg, #3b82f6, #2563eb); color: white;">
            <h3 style="font-size: 2rem; margin-bottom: 0.5rem; color: white;">{{ courses.count }}</h3>
            <p>My Courses</p>
        </div>
        <div class="card" style="background: linear-gradient(135deg, #10b981, #059669); color: white;">
            <h3 style="font-size: 2rem; margin-bottom: 0.5rem; color: white;">{{ completed_modules }}</h3>
            <p>Completed Modules</p>
        </div>

        <div class="card" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white;">
            <h3 style="font-size: 2rem; margin-bottom: 0.5rem; color: white;">{{ announcements.count }}</h3>
            <p>Announcements</p>
        </div>
    </div>

    <!-- Photo Gallery Section -->
    <div style="margin-bottom: 3rem;">
        <h2 style="color: #1e3a8a; font-size: 2rem; margin-bottom: 1.5rem; font-weight: 700;">Gallery</h2>

        {% if gallery_images %}
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
            {% for image in gallery_images %}
            <div
                style="border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); height: 180px; position: relative; group">
                <img src="{{ image.image.url }}" alt="{{ image.caption }}"
                    style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease;">
                {% if image.caption %}
                <div
                    style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); padding: 1rem 0.5rem 0.5rem; color: white; font-size: 0.9rem; font-weight: 600;">
                    {{ image.caption }}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        <div style="text-align: right; margin-top: 1rem;">
            <a href="{% url 'gallery' %}" style="color: #2563eb; font-weight: 600; text-decoration: none;">View All
                Photos &rarr;</a>
        </div>
        {% else %}
        <div class="card" style="text-align: center; color: #64748b; padding: 3rem;">
            <p style="font-size: 1.2rem;">No gallery photos available.</p>
        </div>
        {% endif %}
    </div>

    <div class="grid grid-2">
        <!-- My Training Courses -->
        <div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2 style="color: #1e3a8a; margin: 0;">My Training Courses</h2>
                <a href="{% url 'all_courses' %}" style="color: #2563eb; font-weight: 600; text-decoration: none;">See
                    All &rarr;</a>
            </div>
            {% if courses %}
            {% for course in courses %}
            <div class="card" style="display: flex; gap: 1.5rem; align-items: center; padding: 1.25rem;">
                {% if course.thumbnail %}
                <img src="{{ course.thumbnail.url }}" alt="{{ course.name }}"
                    style="width: 100px; height: 100px; object-fit: contain !important; background: #f8f9fa; border-radius: 0.75rem;">
                {% else %}
                <div
                    style="width: 100px; height: 100px; background: #f1f5f9; border-radius: 0.75rem; display: flex; align-items: center; justify-content: center; color: #94a3b8;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                </div>
                {% endif %}

                <div style="flex: 1;">
                    <h3 style="color: #1e3a8a; margin: 0 0 0.25rem 0;">{{ course.name }}</h3>
                    <p
                        style="color: #64748b; font-weight: 600; margin: 0 0 0.75rem 0; font-size: 0.95rem; display: flex; align-items: center; gap: 6px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        Duration: {{ course.duration }}
                    </p>
                    <a href="{% url 'course_detail' course.id %}" class="btn btn-primary-solid"
                        style="padding: 0.5rem 1.25rem; font-size: 0.9rem;">View Course</a>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="card">
                <p style="text-align: center; color: #64748b;">No courses assigned to you yet.</p>
            </div>
            {% endif %}
        </div>

        <!-- Recent Activity -->
        <div>
            <!-- Announcements -->
            <h2 style="color: #1e3a8a; margin-bottom: 1rem;">Recent Announcements</h2>
            {% if announcements %}
            {% for announcement in announcements %}
            <div class="card">
                <h4 style="color: #1e3a8a; margin-bottom: 0.5rem;">{{ announcement.title }}</h4>
                <p style="color: #64748b; font-size: 0.875rem; margin-bottom: 0.5rem;">{{ announcement.created_at|date:"F d, Y" }}</p>
                <p>{{ announcement.content|truncatewords:30 }}</p>
            </div>
            {% endfor %}
            <a href="{% url 'announcements' %}" class="btn btn-outline" style="width: 100%;">View All
                Announcements</a>
            {% else %}
            <div class="card">
                <p style="text-align: center; color: #64748b;">No announcements yet.</p>
            </div>
            {% endif %}


        </div>
    </div>
</div>
{% endblock %}
